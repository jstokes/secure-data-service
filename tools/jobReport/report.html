<html>
  <head>
    <title>Ingestion Job Report</title>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript">
    
    // Load the Visualization API and the piechart package.
    google.load('visualization', '1', {'packages':['corechart']});
      
    // Set a callback to run when the Google Visualization API is loaded.
    google.setOnLoadCallback(drawChart);
      
    function drawChart() {
      var chartData = { 
        'cols': [ 
          { label: 'Stage Name', type: 'string'},
          { label: 'Elapsed Time', type: 'number'}
        ],
        'rows': [] };

      var jsonData = $.ajax({
          url: "http://localhost:8080/job",
          dataType:"json",
          async: false
          }).responseText;

      var jobs = jQuery.parseJSON(jsonData);
      $.each(jobs[0].stages, function(key, val) {
        chartData.rows.push( { c:[ {v: val.stageName}, {v: val.elapsedTime, f: val.elapsedTime/1000 + ' seconds' } ] });
      });

      // Create our data table out of JSON data loaded from server.
      var data = new google.visualization.DataTable(chartData);

      // Instantiate and draw our chart, passing in some options.
      var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
      chart.draw(data, {title: 'Stage Breakdown: ' + jobs[0]._id, width: 1024, height: 768});
    }

    </script>
  </head>

  <body>
    <!--Div that will hold the pie chart-->
    <div id="chart_div"></div>
  </body>
</html>