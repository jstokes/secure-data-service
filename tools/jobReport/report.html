<html>
  <head>
    <title>Ingestion Job Report</title>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript">
    
    // Load the Visualization API and the piechart package.
    google.load('visualization', '1', {'packages':['corechart']});
      
    // Set a callback to run when the Google Visualization API is loaded.
    google.setOnLoadCallback(listJobs);

    function listJobs() {
      var jsonData = $.ajax({
          url: "http://localhost:8080/job",
          dataType:"json",
          async: false
          }).responseText;
      var jobs = jQuery.parseJSON(jsonData);
      $.each(jobs, function(key, val) {
        $('#job_chooser').append('<a href="#" onclick="drawChart(\''+val._id+'\')">'+val._id+'</a><br/>');
      });
    }
      
    function drawChart(jobId) {
      var chartData = { 
        'cols': [ 
          { label: 'Stage Name', type: 'string'},
          { label: 'Elapsed Time', type: 'number'}
        ],
        'rows': [] };

      var jsonData = $.ajax({
          url: "http://localhost:8080/job/"+jobId,
          dataType:"json",
          async: false
          }).responseText;

      var job = jQuery.parseJSON(jsonData);
      $.each(job.stages, function(key, val) {
        chartData.rows.push( { c:[ {v: val.stageName}, {v: val.elapsedTime, f: val.elapsedTime/1000 + ' seconds' } ] });
      });

      // Create our data table out of JSON data loaded from server.
      var data = new google.visualization.DataTable(chartData);

      // Instantiate and draw our chart, passing in some options.
      var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
      chart.draw(data, {title: 'Stage Breakdown: ' + job._id, width: 1024, height: 768});
    }

  </script>

  <script>
    google.load("visualization","1",{packages:["corechart"]});
    google.setOnLoadCallback(drawChart);    

    function drawChart() {
        var chartData = {
            'cols': [
                { label: 'Entity', type: 'string'},
                { label: '# of Records', type: 'number'},
                { label: 'Total Time', type: 'number'} 
            ],
            'rows': []
        };
        var jsonData = $.ajax({
          url: "http://localhost:8080/stage",
          dataType:"json",
          async: false
      }).responseText;

        var jobs = jQuery.parseJSON(jsonData);

    }
  </script>
  </head>

  <body>
    <div id="job_chooser">
      <h3>Available Jobs:</h3>
    </div>

    <!--Div that will hold the pie chart-->
    <div id="chart_div"></div>
  </body>
</html>
