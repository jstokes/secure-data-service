
<smooks-resource-list xmlns="http://www.milyn.org/xsd/smooks-1.1.xsd" xmlns:core="http://www.milyn.org/xsd/smooks/smooks-core-1.4.xsd"
  xmlns:jb="http://www.milyn.org/xsd/smooks/javabean-1.3.xsd" xmlns:camel="http://www.milyn.org/xsd/smooks/camel-1.4.xsd"
  xmlns:csv="http://www.milyn.org/xsd/smooks/csv-1.2.xsd">

  <params>
    <param name="stream.filter.type">SAX</param>
    <param name="terminate.on.visitor.exception">false</param>
  </params>

<csv:reader
    fields="SessionName,
    SchoolYear,
    Term,
    BeginDate,
    EndDate,
    TotalInstructionalDays,
    AvailableCredit_CreditType,AvailableCredit_CreditConversion,AvailableCredit_Credit,
    CourseOfferingReference_CourseOfferingIdentity_LocalCourseCode,CourseOfferingReference_CourseOfferingIdentity_Term,CourseOfferingReference_CourseOfferingIdentity_SchoolYear,
    	CourseOfferingReference_CourseOfferingIdentity_CourseCode_IdentificationSystem,CourseOfferingReference_CourseOfferingIdentity_CourseCode_AssigningOrganizationCode,CourseOfferingReference_CourseOfferingIdentity_CourseCode_Id,
    SchoolReference_EducationalOrgIdentity_StateOrganizationId,SchoolReference_EducationalOrgIdentity_EducationalOrgIdentificationCode_IdentificationSystem,SchoolReference_EducationalOrgIdentity_EducationalOrgIdentificationCode_Id,
    SessionReference_SessionIdentity_SessionName,SessionReference_SessionIdentity_Term,SessionReference_SessionIdentity_SchoolYear,
    LocationReference_LocationIdentity_ClassroomIdentificationCode,
    ClassPeriodReference_ClassPeriodIdentity_ClassPeriodName,
    ProgramReference_ProgramIdentity_ProgramId,ProgramReference_ProgramIdentity_ProgramType">

</csv:reader>

<jb:bean beanId="record" class="org.slc.sli.ingestion.NeutralRecord" createOnElement="csv-record">

    <jb:expression property="recordType">'session'</jb:expression>
    <jb:value property="localId" data="csv-record/SessionName" />
    <jb:wiring property="attributes" beanIdRef="sessionAttributes" />
  </jb:bean>

  <jb:bean beanId="sessionAttributes" class="java.util.HashMap" createOnElement="csv-record">

   <!-- UniqueSessionCode -->
   <jb:value property="sessionName" data="csv-record/SessionName" />

   <!--SequenceOfCourse -->
   <jb:value property="schoolYear" data="csv-record/SchoolYear"/>

   <!-- EducationalEnvironment -->
   <jb:value property="term" data="csv-record/Term"/>

   <!-- MediumOfinstruction -->
   <jb:value property="beginDate" data="csv-record/BeginDate"/>

   <!-- PopulationServed -->
   <jb:value property="endDate" data="csv-record/EndDate"/>

   <!-- PopulationServed -->
   <jb:value property="totalInstructionalDays" data="csv-record/TotalInstructionalDays"/>

   <!-- AvailableCredit -->
   <jb:wiring property="availableCredit" beanIdRef="AvailableCreditType" />

	<!-- CourseOfferingReference -->
	<jb:value property="courseOfferingReference" data="csv-record/CourseOfferingReference_CourseOfferingIdentity_LocalCourseCode"/>

    <!-- SchoolReference -->
	<jb:value property="schoolReference" data="csv-record/SchoolReference_EducationalOrgIdentity_StateOrganizationId" />

	<!-- SessionReference -->
	<jb:value property="sessionReference" data="csv-record/SessionReference_SessionIdentity_SessionName" />

	<!-- ProgramReference -->
	<jb:wiring property="programReference" beanIdRef="ProgramReferenceTypeArray" />
 </jb:bean>

    <!-- AvailableCreditsType -->
    <jb:bean beanId="AvailableCreditType" class="java.util.HashMap" createOnElement="csv-record">
    	<jb:value property="creditType" data="csv-record/AvailableCredit_CreditType"/>
    	<jb:value property="creditConversion" data="csv-record/AvailableCredit_CreditConversion"/>
    	<jb:value property="credit" data="csv-record/AvailableCredit_Credit"/>
    </jb:bean>

	<!-- ProgramReferenceType -->
	<jb:bean beanId="ProgramReferenceTypeArray" class="java.util.ArrayList" createOnElement="csv-record">
				<jb:value data="csv-record/ProgramReference_ProgramIdentity_ProgramId"/>
	</jb:bean>

</smooks-resource-list>
