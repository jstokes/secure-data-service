<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:util="http://www.springframework.org/schema/util"
  xsi:schemaLocation="
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

  <util:map id="ftlIdRefConfigs" key-type="java.lang.String" value-type="java.lang.String">
      <!--Interchange StudentAssessmenet -->
      <entry key="/InterchangeStudentAssessment/StudentAssessment/AssessmentReference"
          value="idRefResolution/InterchangeStudentAssessment/StudentAssessment/AssessmentReference.ftl" />

      <entry key="/InterchangeStudentAssessment/StudentAssessment/StudentReference"
          value="idRefResolution/InterchangeStudentAssessment/StudentAssessment/StudentReference.ftl" />

      <entry key="/InterchangeStudentAssessment/StudentObjectiveAssessment/StudentAssessmentReference"
          value="idRefResolution/InterchangeStudentAssessment/StudentObjectiveAssessment/StudentAssessmentReference.ftl" />

      <entry key="/InterchangeStudentAssessment/StudentAssessmentItem/StudentAssessmentReference"
          value="idRefResolution/InterchangeStudentAssessment/StudentAssessmentItem/StudentAssessmentReference.ftl" />

      <!--End of Interchange StudentAssment -->

    <entry key="/InterchangeAssessmentMetadata/Assessment/AssessmentFamilyReference"
          value="idRefResolution/InterchangeAssessmentMetadata/Assessment/AssessmentFamilyReference.ftl" />

    <entry key="/InterchangeAssessmentMetadata/AssessmentFamily/AssessmentFamilyReference"
          value="idRefResolution/InterchangeAssessmentMetadata/AssessmentFamily/AssessmentFamilyReference.ftl" />

    <entry key="/InterchangeAssessmentMetadata/AssessmentItem/LearningStandardReference"
          value="idRefResolution/InterchangeAssessmentMetadata/AssessmentItem/LearningStandardReference.ftl" />

    <entry key="/InterchangeAssessmentMetadata/ObjectiveAssessment/LearningStandardReference"
          value="idRefResolution/InterchangeAssessmentMetadata/ObjectiveAssessment/LearningStandardReference.ftl" />

    <entry key="/InterchangeAssessmentMetadata/ObjectiveAssessment/LearningObjectiveReference"
          value="idRefResolution/InterchangeAssessmentMetadata/ObjectiveAssessment/LearningObjectiveReference.ftl" />


    <entry key="/InterchangeAssessmentMetadata/LearningObjective/LearningStandardReference"
          value="idRefResolution/InterchangeAssessmentMetadata/LearningObjective/LearningStandardReference.ftl" />

    <entry key="/InterchangeAssessmentMetadata/LearningObjective/LearningObjectiveReference"
          value="idRefResolution/InterchangeAssessmentMetadata/LearningObjective/LearningObjectiveReference.ftl" />
    <entry key="/InterchangeStudentGrade/StudentCompetency/LearningObjectiveReference"
          value="idRefResolution/InterchangeStudentGrade/StudentCompetency/LearningObjectiveReference.ftl" />

    <entry key="/InterchangeStudentGrade/StudentCompetency/StudentCompetencyObjectiveReference"
          value="idRefResolution/InterchangeStudentGrade/StudentCompetency/StudentCompetencyObjectiveReference.ftl" />

    <entry key="/InterchangeStudentGrade/GradebookEntry/LearningObjectiveReference"
          value="idRefResolution/InterchangeStudentGrade/GradebookEntry/LearningObjectiveReference.ftl" />

    <!-- Interchange StaffAssociation -->
    <entry key="/InterchangeStaffAssociation/StaffEducationOrgAssignmentAssociation/StaffReference"
          value="idRefResolution/InterchangeStaffAssociation/StaffEducationOrgAssignmentAssociation/StaffReference.ftl" />

    <entry key="/InterchangeStaffAssociation/StaffProgramAssociation/StaffReference"
          value="idRefResolution/InterchangeStaffAssociation/StaffProgramAssociation/StaffReference.ftl" />

     <entry key="/InterchangeStaffAssociation/TeacherSchoolAssociation/TeacherReference"
          value="idRefResolution/InterchangeStaffAssociation/TeacherSchoolAssociation/TeacherReference.ftl" />

    <entry key="/InterchangeStaffAssociation/TeacherSectionAssociation/TeacherReference"
          value="idRefResolution/InterchangeStaffAssociation/TeacherSectionAssociation/TeacherReference.ftl" />

    <!-- end of interchange StaffAssociation -->

    <!--interchange StudentDiscipline -->
    <entry key="/InterchangeStudentDiscipline/DisciplineAction/DisciplineIncidentReference"
          value="idRefResolution/InterchangeStudentDiscipline/DisciplineAction/DisciplineIncidentReference.ftl" />
    <!-- end of interchange StaffAssociation>= -->

    <!--interchange EducationOrgCalendar -->
    <entry key="/InterchangeEducationOrgCalendar/Session/GradingPeriodReference"
          value="idRefResolution/InterchangeEducationOrgCalendar/Session/GradingPeriodReference.ftl" />
    <!-- end of interchange EducationOrgCalendar>= -->

    <!-- Interchange StudentParent -->
    <entry key="/InterchangeStudentParent/StudentParentAssociation/ParentReference"
          value="idRefResolution/InterchangeStudentParent/StudentParentAssociation/ParentReference.ftl" />

    <entry key="/InterchangeStudentParent/StudentParentAssociation/StudentReference"
          value="idRefResolution/InterchangeStudentParent/StudentParentAssociation/StudentReference.ftl" />

    <!-- end of interchange StudentParent -->

    <!-- Interchange EducationOrganization -->
    <entry key="/InterchangeEducationOrganization/School/ProgramReference"
          value="idRefResolution/InterchangeEducationOrganization/School/ProgramReference.ftl" />

        <entry key="/InterchangeEducationOrganization/School/EducationOrganizationPeerReference"
          value="idRefResolution/InterchangeEducationOrganization/School/EducationOrganizationPeerReference.ftl" />

        <entry key="/InterchangeEducationOrganization/School/LocalEducationAgencyReference"
          value="idRefResolution/InterchangeEducationOrganization/School/LocalEducationAgencyReference.ftl" />

     <entry key="/InterchangeEducationOrganization/Course/EducationOrganizationReference"
          value="idRefResolution/InterchangeEducationOrganization/Course/EducationOrganizationReference.ftl" />

    <entry key="/InterchangeEducationOrganization/StateEducationAgency/ProgramReference"
          value="idRefResolution/InterchangeEducationOrganization/StateEducationAgency/ProgramReference.ftl" />

        <entry key="/InterchangeEducationOrganization/StateEducationAgency/EducationOrganizationPeerReference"
          value="idRefResolution/InterchangeEducationOrganization/StateEducationAgency/EducationOrganizationPeerReference.ftl" />

        <entry key="/InterchangeEducationOrganization/LocalEducationAgency/ProgramReference"
          value="idRefResolution/InterchangeEducationOrganization/LocalEducationAgency/ProgramReference.ftl" />

        <entry key="/InterchangeEducationOrganization/LocalEducationAgency/EducationOrganizationPeerReference"
          value="idRefResolution/InterchangeEducationOrganization/LocalEducationAgency/EducationOrganizationPeerReference.ftl" />

        <entry key="/InterchangeEducationOrganization/LocalEducationAgency/LocalEducationAgencyReference"
          value="idRefResolution/InterchangeEducationOrganization/LocalEducationAgency/LocalEducationAgencyReference.ftl" />

    <entry key="/InterchangeStudentGrade/ReportCard/GradeReference"
           value="idRefResolution/InterchangeStudentGrade/ReportCard/GradeReference.ftl" />

    <entry key="/InterchangeStudentGrade/ReportCard/StudentCompetencyReference"
           value="idRefResolution/InterchangeStudentGrade/ReportCard/StudentCompetencyReference.ftl" />

    <entry key="/InterchangeStudentGrade/ReportCard/GradingPeriodReference"
          value="idRefResolution/InterchangeStudentGrade/ReportCard/GradingPeriodReference.ftl" />

    <entry key="/InterchangeEducationOrganization/LocalEducationAgency/StateEducationAgencyReference"
          value="idRefResolution/InterchangeEducationOrganization/LocalEducationAgency/StateEducationAgencyReference.ftl" />

    <!-- end of Interchange EducationOrganization -->

    <!-- Interchange MasterSchedule -->
    <entry key="/InterchangeMasterSchedule/Section/CourseOfferingReference"
          value="idRefResolution/InterchangeMasterSchedule/Section/CourseOfferingReference.ftl" />
    <!-- end of Interchange MasterSchedule -->

    <!-- Interchange StudentCohort -->
    <entry key="/InterchangeStudentCohort/StudentCohortAssociation/CohortReference"
          value="idRefResolution/InterchangeStudentCohort/StudentCohortAssociation/CohortReference.ftl" />
    <!-- end of Interchange StudentCohort -->

    <entry key="/InterchangeEducationOrgCalendar/GradingPeriod/CalendarDateReference"
           value="idRefResolution/InterchangeEducationOrgCalendar/GradingPeriod/CalendarDateReference.ftl" />

    <!-- Interchange StudentGrade -->
    <entry key="/InterchangeStudentGrade/CourseTranscript/StudentAcademicRecordReference"
           value="idRefResolution/InterchangeStudentGrade/CourseTranscript/StudentAcademicRecordReference.ftl" />
    <entry key="/InterchangeStudentGrade/StudentGradebookEntry/GradebookEntryReference"
           value="idRefResolution/InterchangeStudentGrade/StudentGradebookEntry/GradebookEntryReference.ftl" />
    <entry key="/InterchangeStudentGrade/StudentAcademicRecord/ReportCardReference"
           value="idRefResolution/InterchangeStudentGrade/StudentAcademicRecord/ReportCardReference.ftl" />
    <!-- end of Interchange StudentGrade -->

    <!-- Interchange StudentEnrollment -->
    <entry key="/InterchangeStudentEnrollment/StudentSchoolAssociation/GraduationPlanReference"
           value="idRefResolution/InterchangeStudentEnrollment/StudentSchoolAssociation/GraduationPlanReference.ftl" />
    <!-- end of Interchange StudentEnrollment -->

  </util:map>

  <bean id="freeMarkerExtendedReferenceResolver" class="org.slc.sli.ingestion.referenceresolution.FreeMarkerExtendedReferenceResolver" scope="prototype">
    <property name="idRefConfigs" ref="ftlIdRefConfigs" />
  </bean>

  <bean id="simpleReferenceResolver" class="org.slc.sli.ingestion.referenceresolution.SimpleReferenceResolver"/>

  <bean id="IdReferenceResolutionHandler" class="org.slc.sli.ingestion.xml.idref.IdRefResolutionHandler" scope="prototype">
    <property name="preValidators">
      <util:list value-type="org.slc.sli.ingestion.validation.Validator">
        <bean class="org.slc.sli.ingestion.landingzone.validation.XmlFileValidator" />
        <ref bean="xsdValidator" />
      </util:list>
    </property>
    <property name="supportedResolvers" ref="strategyConfig" />
    <property name="idReferenceInterchanges" ref="idReferenceResolutionInterchanges"/>
  </bean>
  
  <!-- interchanges that rely on id reference resolution for correctness -->
  <util:set id="idReferenceResolutionInterchanges" set-class="java.util.HashSet" value-type="java.lang.String">
    <value>AssessmentMetadata</value>
    <value>EducationOrganization</value>
    <value>EducationOrgCalendar</value>
    <value>MasterSchedule</value>
    <value>StaffAssociation</value>
    <value>StudentAssessment</value>
    <value>StudentDiscipline</value>
    <value>StudentEnrollment</value>
    <value>StudentGrades</value>
    <value>StudentParent</value>
  </util:set>

  <util:map id="strategyConfig">
    <entry key="/InterchangeAssessmentMetadata/Assessment/AssessmentFamilyReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeAssessmentMetadata/AssessmentFamily/AssessmentFamilyReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeAssessmentMetadata/AssessmentItem/LearningStandardReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeAssessmentMetadata/ObjectiveAssessment/LearningStandardReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeAssessmentMetadata/ObjectiveAssessment/LearningObjectiveReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeAssessmentMetadata/LearningObjective/LearningStandardReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeAssessmentMetadata/LearningObjective/LearningObjectiveReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeAssessmentMetadata/Assessment/AssessmentItemReference" value-ref="simpleReferenceResolver" />
    <entry key="/InterchangeAssessmentMetadata/Assessment/ObjectiveAssessmentReference" value-ref="simpleReferenceResolver" />
    <entry key="/InterchangeAssessmentMetadata/ObjectiveAssessment/AssessmentItemReference" value-ref="simpleReferenceResolver" />
    <entry key="/InterchangeAssessmentMetadata/ObjectiveAssessment/ObjectiveAssessmentReference" value-ref="simpleReferenceResolver" />

    <entry key="/InterchangeStudentGrade/StudentCompetency/LearningObjectiveReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeStudentGrade/StudentCompetency/StudentCompetencyObjectiveReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeStudentGrade/GradebookEntry/LearningObjectiveReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeStudentGrade/ReportCard/GradeReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeStudentGrade/CourseTranscript/StudentAcademicRecordReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeStudentGrade/ReportCard/StudentCompetencyReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeStudentGrade/StudentAcademicRecord/ReportCardReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeStudentGrade/StudentAcademicRecord/DiplomaReference" value-ref="simpleReferenceResolver" />
    <entry key="/InterchangeStudentGrade/StudentGradebookEntry/GradebookEntryReference" value-ref="freeMarkerExtendedReferenceResolver" />

    <entry key="/InterchangeEducationOrgCalendar/GradingPeriod/CalendarDateReference" value-ref="freeMarkerExtendedReferenceResolver" />

    <entry key="/InterchangeStudentAssessment/StudentAssessment/AssessmentReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeStudentAssessment/StudentAssessment/StudentReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeStudentAssessment/StudentAssessmentItem/StudentAssessmentReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeStudentAssessment/StudentAssessmentItem/StudentObjectiveAssessmentReference" value-ref="simpleReferenceResolver" />
    <entry key="/InterchangeStudentAssessment/StudentObjectiveAssessment/StudentAssessmentReference" value-ref="freeMarkerExtendedReferenceResolver" />

    <entry key="/InterchangeStaffAssociation/StaffEducationOrgAssignmentAssociation/StaffReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeStaffAssociation/StaffProgramAssociation/StaffReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeStaffAssociation/TeacherSchoolAssociation/TeacherReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeStaffAssociation/TeacherSectionAssociation/TeacherReference" value-ref="freeMarkerExtendedReferenceResolver" />

    <entry key="/InterchangeStudentDiscipline/DisciplineAction/DisciplineIncidentReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeStudentDiscipline/StudentDisciplineIncidentAssociation/DisciplineIncidentReference" value-ref="simpleReferenceResolver" />

    <entry key="/InterchangeStudentEnrollment/StudentSchoolAssociation/GraduationPlanReference" value-ref="freeMarkerExtendedReferenceResolver" />

    <entry key="/InterchangeStudentCohort/StudentCohortAssociation/CohortReference" value-ref="freeMarkerExtendedReferenceResolver" />

    <entry key="/InterchangeEducationOrgCalendar/Session/GradingPeriodReference" value-ref="freeMarkerExtendedReferenceResolver" />

    <entry key="/InterchangeEducationOrganization/School/ProgramReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeEducationOrganization/School/EducationOrganizationPeerReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeEducationOrganization/School/LocalEducationAgencyReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeEducationOrganization/Course/EducationOrganizationReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeEducationOrganization/StateEducationAgency/ProgramReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeEducationOrganization/StateEducationAgency/EducationOrganizationPeerReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeEducationOrganization/LocalEducationAgency/ProgramReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeEducationOrganization/LocalEducationAgency/EducationOrganizationPeerReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeEducationOrganization/LocalEducationAgency/LocalEducationAgencyReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeEducationOrganization/LocalEducationAgency/StateEducationAgencyReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeEducationOrganization/ObjectiveAssessment/AssessmentReference" value-ref="simpleReferenceResolver" />
    <entry key="/InterchangeEducationOrganization/ObjectiveAssessment/ObjectiveAssessmentReference" value-ref="simpleReferenceResolver" />

    <entry key="/InterchangeMasterSchedule/Section/CourseOfferingReference" value-ref="freeMarkerExtendedReferenceResolver" />

    <entry key="/InterchangeStudentParent/StudentParentAssociation/StudentReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeStudentParent/StudentParentAssociation/ParentReference" value-ref="freeMarkerExtendedReferenceResolver" />
    <entry key="/InterchangeEducationOrgCalendar/Session/CalendarDateReference" value-ref="simpleReferenceResolver" />
  </util:map>
</beans>
