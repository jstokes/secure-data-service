/*
 * Copyright 2012-2013 inBloom, Inc. and its affiliates.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.slc.sli.api.resources.generic.service;

import org.slc.sli.api.config.EntityDefinition;
import org.slc.sli.api.service.query.ApiQuery;
import org.slc.sli.domain.NeutralCriteria;
import org.springframework.stereotype.Component;

import java.net.URI;
import java.util.Arrays;

/**
 * Helper class for resource services
 *
 */

@Component
public class ResourceServiceHelper {

    public ApiQuery getApiQuery(EntityDefinition definition, final URI requestURI) {
        ApiQuery apiQuery = new ApiQuery(definition.getType(), requestURI);
        addTypeCriteria(definition, apiQuery);

        apiQuery.addCriteria(new NeutralCriteria("body",NeutralCriteria.CRITERIA_EXISTS,true,false));

        return apiQuery;
    }

    public ApiQuery getApiQuery(EntityDefinition definition) {
        return getApiQuery(definition, null);
    }

    protected ApiQuery addTypeCriteria(EntityDefinition entityDefinition, ApiQuery apiQuery) {

        if (apiQuery != null && entityDefinition != null) {
            if( !entityDefinition.getType().equals(entityDefinition.getStoredCollectionName())) {
               apiQuery.addCriteria(new NeutralCriteria("type", NeutralCriteria.CRITERIA_IN, Arrays.asList(entityDefinition.getDbType()), false));
            }
            NeutralCriteria criteria = entityDefinition.getTypeCriteria();
            if(criteria != null) {
                apiQuery.addCriteria(criteria);
            }
        }
        return apiQuery;
    }
}
