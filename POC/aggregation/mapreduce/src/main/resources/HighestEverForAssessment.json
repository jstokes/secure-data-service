
{
  "calculated_value" : {
      "metadata" : {
          "type" : "Assessment",
          "value_type : "java.lang.Double",
          "description" : "Calculate the highest ever score per student for the grade 7 state math assessment.",
          "abbreviation" : "HE-SMA-7"
      },

      "hadoop" : {
          "map" : {
              "class" : "org.slc.sli.aggregation.mapreduce.map.IDMapper",
              "input" {
                  "collection" : "sli.studentAssessmentAssociation",
                  "key_field" : "body.studentId",
                  "query" : { "body.assessmentId" : "@ID@", "body.scoreResults.assessmentReportingMethod":"Scale score" },
                  "fields" : { "metaData.tenantId" : 1, "body.studentId" : 1, "body.scoreResults" : 1 }",
                  "key_type" : "org.slc.sli.aggregation.mapreduce.map.key.IdFieldEmittableKey",
                  "value_type" : "com.mongodb.hadoop.io.BSONWritable",
                  "format_type" : "org.slc.sli.aggregation.mapreduce.io.MongoIdInputFormat",
                  "read_from_secondaries" : true
              },
              "output" : {
                  "key_type" : "org.slc.sli.aggregation.mapreduce.map.key.IdFieldEmittableKey",
                  "value_type" : "com.mongodb.hadoop.io.BSONWritable",
                  "format_type" : "org.slc.sli.aggregation.mapreduce.io.MongoAggFormatter"
              }
          },
          "reduce" : {
              "class" : "org.sli.sli.aggregation.mapreduce.reduce.calculated.HighestEver"
              "collection" : "sli.student",
              "field" : "calculatedValues.assessments.@ID@.HighestEver.ScaleScore"
          },
          "options" : { }
      }
  },

  "aggregation" : {
      "metadata" : {
          "description" : "Aggregate of the highest scores for the grade 7 state math assessment for the school",
          "abbreviation" : "HE-AGG-SMA-7",
          "type" : "count",
          "field" : "calculated_values.assessments.@ID@.HighestEver.ScaleScore",
          "valid_range" : { "min" : 0, "max" : 100 },
          "bands" : [
             { "rank" : -1, "description" : "invalid score" },
             { "rank" :  0, "description" : "no score" },
             { "rank" :  1, "description" : "below standard",   "range" : { "min" :  0, "max" :  70 } },
             { "rank" :  2, "description" : "at standard",      "range" : { "min" : 71, "max" :  85 } },
             { "rank" :  3, "description" : "exceeds standard", "range" : { "min" : 86, "max" : 100 } }
          ]
      },

      "hadoop" : {
          "map" : {
              "class" : "org.slc.sli.aggregation.mapreduce.map.IDMapper",
              "input" : {
                  "collection" : "student",

                  "key_field" : "_id",
                  "query" : { }
                  "fields" : { "calculatedValues.assessments.@ID@.HighestEver.ScaleScore" : 1 },

                  "key_type" : "org.slc.sli.aggregation.mapreduce.map.key.IdFieldEmittableKey",
                  "value_type" : "com.mongodb.hadoop.io.BSONWritable",
                  "format_type" : "org.slc.sli.aggregation.mapreduce.io.MongoIdInputFormat",
                  "read_from_secondaries" : true
              },


              "output" : {
                  "key_type" : "org.slc.sli.aggregation.mapreduce.map.key.IdFieldEmittableKey",
                  "value_type" : "com.mongodb.hadoop.io.BSONWritable",
                  "format_type" : "org.slc.sli.aggregation.mapreduce.io.MongoAggFormatter"
              }
          },
          "reduce" : {
              "class" : "org.sli.sli.aggregation.mapreduce.reduce.aggregate.HighestEver",
              "collection" : "sli.school",
              "field" : "aggregates.assessments.@ID@.ScaleScore"
          },
          "options" : { }
      }
  },
  "schedule" : {
      "event" : "create student | create SAA",
      "waiting_period" : 600,
      "command" : "hadoop",
      "arguments" : "jar HighestEver.jar StateMath_conf.json -fs hdfs://localhost:9001 -jt http://localhost:9000"
      "retry_on_failure" : "false"
  }
}
